<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<title>–¢–µ—Å—Ç –ø–æ –º–∞—Ç–µ—Ä–∏–∞–ª—É</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<link rel="stylesheet" href="style.css">
<script src="auth-check.js"></script>
</head>

<body>

<header class="header">
  <div class="container header-inner">
    <div class="logo">
      <a href="index.html">–†–µ–∞–±–∏–ª–∏—Ç–∞—Ü–∏—è –ª—ë–≥–∫–∏—Ö</a>
    </div>
    <nav class="nav">
      <a href="index.html">–ì–ª–∞–≤–Ω–∞—è</a>
      <a href="education.html">–û–±—É—á–µ–Ω–∏–µ</a>
      <a href="materials.html">–ú–∞—Ç–µ—Ä–∏–∞–ª—ã</a>
      <a href="profile.html">–õ–∏—á–Ω—ã–π –∫–∞–±–∏–Ω–µ—Ç</a>
    </nav>
    <div class="burger" onclick="toggleMenu()">‚ò∞</div>
  </div>

  <div class="mobile-nav" id="mobileNav">
    <a href="index.html">–ì–ª–∞–≤–Ω–∞—è</a>
    <a href="education.html">–û–±—É—á–µ–Ω–∏–µ</a>
    <a href="materials.html">–ú–∞—Ç–µ—Ä–∏–∞–ª—ã</a>
    <a href="profile.html">–õ–∏—á–Ω—ã–π –∫–∞–±–∏–Ω–µ—Ç</a>
  </div>
</header>

<section class="test-section">
  <div class="container">
    <h1 class="section-title">–ò—Ç–æ–≥–æ–≤—ã–π —Ç–µ—Å—Ç –ø–æ –ø—Ä–æ–≥—Ä–∞–º–º–µ —Ä–µ–∞–±–∏–ª–∏—Ç–∞—Ü–∏–∏</h1>
    
    <div style="background: #E3F2FD; padding: 20px; border-radius: 10px; margin-bottom: 30px;">
      <p style="margin: 0;">
        <strong>‚ÑπÔ∏è –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è:</strong> –û—Ç–≤–µ—Ç—å—Ç–µ –Ω–∞ –≤—Å–µ –≤–æ–ø—Ä–æ—Å—ã. 
        –î–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–∞ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –Ω–∞–±—Ä–∞—Ç—å –º–∏–Ω–∏–º—É–º <strong>5 –ø—Ä–∞–≤–∏–ª—å–Ω—ã—Ö –æ—Ç–≤–µ—Ç–æ–≤ –∏–∑ 7</strong>.
      </p>
    </div>

    <form id="quizForm"></form>

    <div id="result" class="result-box"></div>
  </div>
</section>

<script src="menu.js"></script>
<script>
checkAuth();

// –í–æ–ø—Ä–æ—Å—ã —Å –ø—Ä–∞–≤–∏–ª—å–Ω—ã–º–∏ –æ—Ç–≤–µ—Ç–∞–º–∏
const questions = [
  {
    id: 1,
    text: '1. –û—Å–Ω–æ–≤–Ω–∞—è —Ü–µ–ª—å —Ä–µ–∞–±–∏–ª–∏—Ç–∞—Ü–∏–∏ –ø–æ—Å–ª–µ –ª–µ—á–µ–Ω–∏—è —Ä–∞–∫–∞ –ª—ë–≥–∫–∏—Ö:',
    answers: [
      { text: '–£–ª—É—á—à–µ–Ω–∏–µ –∫–∞—á–µ—Å—Ç–≤–∞ –∂–∏–∑–Ω–∏ –∏ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ —Ñ—É–Ω–∫—Ü–∏–∏ –ª—ë–≥–∫–∏—Ö', correct: true },
      { text: '–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ –Ω–æ–≤—ã—Ö –ª–µ–∫–∞—Ä—Å—Ç–≤', correct: false },
      { text: '–ò—Å–∫–ª—é—á–∏—Ç–µ–ª—å–Ω–æ —Ö–∏—Ä—É—Ä–≥–∏—á–µ—Å–∫–æ–µ –ª–µ—á–µ–Ω–∏–µ', correct: false },
      { text: '–ü–æ–ª–Ω—ã–π –æ—Ç–∫–∞–∑ –æ—Ç —Ñ–∏–∑–∏—á–µ—Å–∫–æ–π –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏', correct: false }
    ]
  },
  {
    id: 2,
    text: '2. –î—ã—Ö–∞—Ç–µ–ª—å–Ω—ã–µ —É–ø—Ä–∞–∂–Ω–µ–Ω–∏—è —Å–ø–æ—Å–æ–±—Å—Ç–≤—É—é—Ç:',
    answers: [
      { text: '–£–ª—É—á—à–µ–Ω–∏—é –≤–µ–Ω—Ç–∏–ª—è—Ü–∏–∏ –ª—ë–≥–∫–∏—Ö', correct: true },
      { text: '–ü–æ–≤—ã—à–µ–Ω–∏—é —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä—ã —Ç–µ–ª–∞', correct: false },
      { text: '–°–Ω–∏–∂–µ–Ω–∏—é –¥–∞–≤–ª–µ–Ω–∏—è', correct: false },
      { text: '–£–≤–µ–ª–∏—á–µ–Ω–∏—é –º–∞—Å—Å—ã —Ç–µ–ª–∞', correct: false }
    ]
  },
  {
    id: 3,
    text: '3. –§–∏–∑–∏—á–µ—Å–∫–∞—è –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å:',
    answers: [
      { text: '–ü–æ—Å—Ç–µ–ø–µ–Ω–Ω–æ–π –∏ –∫–æ–Ω—Ç—Ä–æ–ª–∏—Ä—É–µ–º–æ–π', correct: true },
      { text: '–ò–Ω—Ç–µ–Ω—Å–∏–≤–Ω–æ–π –±–µ–∑ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–π', correct: false },
      { text: '–ò—Å–∫–ª—é—á–µ–Ω–∞ –ø–æ–ª–Ω–æ—Å—Ç—å—é', correct: false },
      { text: '–¢–æ–ª—å–∫–æ —Å–∏–ª–æ–≤—ã–µ —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∏', correct: false }
    ]
  },
  {
    id: 4,
    text: '4. –†–∞—Ü–∏–æ–Ω –ø–∏—Ç–∞–Ω–∏—è –¥–æ–ª–∂–µ–Ω –≤–∫–ª—é—á–∞—Ç—å:',
    answers: [
      { text: '–ë–µ–ª–∫–∏, –≤–∏—Ç–∞–º–∏–Ω—ã –∏ –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∂–∏–¥–∫–æ—Å—Ç–∏', correct: true },
      { text: '–¢–æ–ª—å–∫–æ —É–≥–ª–µ–≤–æ–¥—ã', correct: false },
      { text: '–ñ–∏—Ä–Ω—É—é –ø–∏—â—É', correct: false },
      { text: '–ü–æ–ª–Ω—ã–π –æ—Ç–∫–∞–∑ –æ—Ç –µ–¥—ã', correct: false }
    ]
  },
  {
    id: 5,
    text: '5. –ü—Å–∏—Ö–æ–ª–æ–≥–∏—á–µ—Å–∫–∞—è –ø–æ–¥–¥–µ—Ä–∂–∫–∞ –≤–∞–∂–Ω–∞ –ø–æ—Ç–æ–º—É —á—Ç–æ:',
    answers: [
      { text: '–ü–æ–º–æ–≥–∞–µ—Ç —Å–Ω–∏–∑–∏—Ç—å —Å—Ç—Ä–µ—Å—Å –∏ –∞–¥–∞–ø—Ç–∏—Ä–æ–≤–∞—Ç—å—Å—è', correct: true },
      { text: '–ù–µ –≤–ª–∏—è–µ—Ç –Ω–∞ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ', correct: false },
      { text: '–£–≤–µ–ª–∏—á–∏–≤–∞–µ—Ç –Ω–∞–≥—Ä—É–∑–∫—É', correct: false },
      { text: '–ó–∞–º–µ–Ω—è–µ—Ç —É–ø—Ä–∞–∂–Ω–µ–Ω–∏—è', correct: false }
    ]
  },
  {
    id: 6,
    text: '6. –°–∞–º–æ–∫–æ–Ω—Ç—Ä–æ–ª—å —Å–∏–º–ø—Ç–æ–º–æ–≤ –ø–æ–∑–≤–æ–ª—è–µ—Ç:',
    answers: [
      { text: '–ö–æ—Ä—Ä–µ–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–æ–≥—Ä–∞–º–º—É –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è', correct: true },
      { text: '–ò–≥–Ω–æ—Ä–∏—Ä–æ–≤–∞—Ç—å —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –≤—Ä–∞—á–∞', correct: false },
      { text: '–û—Ç–∫–∞–∑–∞—Ç—å—Å—è –æ—Ç –ª–µ—á–µ–Ω–∏—è', correct: false },
      { text: '–£–≤–µ–ª–∏—á–∏—Ç—å —Å—Ç—Ä–µ—Å—Å', correct: false }
    ]
  },
  {
    id: 7,
    text: '7. –ó–∞–≤–µ—Ä—à–µ–Ω–∏–µ –ø—Ä–æ–≥—Ä–∞–º–º—ã –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–∞–µ—Ç—Å—è:',
    answers: [
      { text: '–ü–æ–ª—É—á–µ–Ω–∏–µ–º —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–∞', correct: true },
      { text: '–£—Å—Ç–Ω—ã–º –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ–º', correct: false },
      { text: '–ü—Ä–æ—Å–º–æ—Ç—Ä–æ–º –≤–∏–¥–µ–æ', correct: false },
      { text: '–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–µ–π', correct: false }
    ]
  }
];

// –§—É–Ω–∫—Ü–∏—è –ø–µ—Ä–µ–º–µ—à–∏–≤–∞–Ω–∏—è –º–∞—Å—Å–∏–≤–∞ (Fisher-Yates shuffle)
function shuffleArray(array) {
  const newArray = [...array];
  for (let i = newArray.length - 1; i > 0; i--) {
    const j = Math.floor(Math.random() * (i + 1));
    [newArray[i], newArray[j]] = [newArray[j], newArray[i]];
  }
  return newArray;
}

// –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º HTML –¥–ª—è —Ç–µ—Å—Ç–∞ —Å –ø–µ—Ä–µ–º–µ—à–∞–Ω–Ω—ã–º–∏ –æ—Ç–≤–µ—Ç–∞–º–∏
function generateQuiz() {
  console.log('üé≤ –ì–µ–Ω–µ—Ä–∞—Ü–∏—è —Ç–µ—Å—Ç–∞ —Å —Ä–∞–Ω–¥–æ–º–∏–∑–∞—Ü–∏–µ–π –æ—Ç–≤–µ—Ç–æ–≤...');
  const form = document.getElementById('quizForm');
  let html = '';

  questions.forEach((question, index) => {
    // –ü–µ—Ä–µ–º–µ—à–∏–≤–∞–µ–º –æ—Ç–≤–µ—Ç—ã –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –≤–æ–ø—Ä–æ—Å–∞
    const shuffledAnswers = shuffleArray(question.answers);
    
    console.log(`–í–æ–ø—Ä–æ—Å ${question.id}:`, {
      '–û—Ä–∏–≥–∏–Ω–∞–ª—å–Ω—ã–π –ø–æ—Ä—è–¥–æ–∫': question.answers.map(a => a.text.substring(0, 30)),
      '–ü–µ—Ä–µ–º–µ—à–∞–Ω–Ω—ã–π –ø–æ—Ä—è–¥–æ–∫': shuffledAnswers.map(a => a.text.substring(0, 30))
    });
    
    html += `
      <div class="question-card">
        <p><strong>${question.text}</strong></p>
        ${shuffledAnswers.map((answer, answerIndex) => `
          <label style="display: block; margin: 10px 0; cursor: pointer;">
            <input type="radio" name="q${question.id}" value="${answer.correct ? '1' : '0'}" 
                   style="margin-right: 10px;">
            ${answer.text}
          </label>
        `).join('')}
      </div>
    `;
  });

  html += `
    <div style="text-align: center; margin-top: 30px;">
      <button type="button" class="btn" onclick="submitTest()">
        ‚úÖ –ó–∞–≤–µ—Ä—à–∏—Ç—å —Ç–µ—Å—Ç –∏ –ø–æ–ª—É—á–∏—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç
      </button>
    </div>
  `;

  form.innerHTML = html;
  console.log('‚úÖ –¢–µ—Å—Ç —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω —Å –ø–µ—Ä–µ–º–µ—à–∞–Ω–Ω—ã–º–∏ –æ—Ç–≤–µ—Ç–∞–º–∏!');
}

// –û—Ç–ø—Ä–∞–≤–∫–∞ —Ç–µ—Å—Ç–∞
async function submitTest() {
  let score = 0;
  let totalQuestions = questions.length;
  let answers = {};
  let allAnswered = true;

  // –ü—Ä–æ–≤–µ—Ä—è–µ–º –æ—Ç–≤–µ—Ç—ã
  for (let i = 1; i <= totalQuestions; i++) {
    const radios = document.getElementsByName('q' + i);
    let answered = false;

    for (let radio of radios) {
      if (radio.checked) {
        answered = true;
        const value = Number(radio.value);
        score += value;
        answers['q' + i] = value;
        break;
      }
    }

    if (!answered) {
      allAnswered = false;
      break;
    }
  }

  if (!allAnswered) {
    alert('‚ùå –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –æ—Ç–≤–µ—Ç—å—Ç–µ –Ω–∞ –≤—Å–µ –≤–æ–ø—Ä–æ—Å—ã!');
    return;
  }

  // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç –Ω–∞ —Å–µ—Ä–≤–µ—Ä
  try {
    const response = await fetch('/api/test/submit', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({
        score: score,
        total_questions: totalQuestions,
        answers: JSON.stringify(answers)
      })
    });

    if (response.ok) {
      const passed = score >= 5;
      
      if (passed) {
        // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —É—Å–ø–µ—Ö –∏ –ø–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª—è–µ–º –Ω–∞ —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç
        showResult(`
          <div style="background: #c8e6c9; padding: 30px; border-radius: 15px; text-align: center;">
            <h2 style="color: #2e7d32; margin: 0 0 15px 0;">üéâ –ü–æ–∑–¥—Ä–∞–≤–ª—è–µ–º!</h2>
            <p style="font-size: 1.2em; margin: 0 0 10px 0;">
              –í—ã —É—Å–ø–µ—à–Ω–æ –ø—Ä–æ—à–ª–∏ —Ç–µ—Å—Ç!
            </p>
            <p style="font-size: 1.5em; font-weight: bold; margin: 0 0 20px 0; color: #2e7d32;">
              –í–∞—à —Ä–µ–∑—É–ª—å—Ç–∞—Ç: ${score} –∏–∑ ${totalQuestions}
            </p>
            <p style="margin: 0 0 20px 0;">
              –ü–µ—Ä–µ—Ö–æ–¥–∏–º –∫ –ø–æ–ª—É—á–µ–Ω–∏—é —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–∞...
            </p>
          </div>
        `);
        
        setTimeout(() => {
          window.location.href = 'certificate.html';
        }, 2000);
        
      } else {
        // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç —Å –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ–º –ø–æ–ø—Ä–æ–±–æ–≤–∞—Ç—å —Å–Ω–æ–≤–∞
        showResult(`
          <div style="background: #ffcdd2; padding: 30px; border-radius: 15px; text-align: center;">
            <h2 style="color: #c62828; margin: 0 0 15px 0;">üòî –ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –±–∞–ª–ª–æ–≤</h2>
            <p style="font-size: 1.2em; margin: 0 0 10px 0;">
              –í–∞—à —Ä–µ–∑—É–ª—å—Ç–∞—Ç: ${score} –∏–∑ ${totalQuestions}
            </p>
            <p style="margin: 0 0 20px 0;">
              –î–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–∞ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –º–∏–Ω–∏–º—É–º <strong>5 –ø—Ä–∞–≤–∏–ª—å–Ω—ã—Ö –æ—Ç–≤–µ—Ç–æ–≤</strong>.
            </p>
            <p style="margin: 0;">
              –†–µ–∫–æ–º–µ–Ω–¥—É–µ–º –ø–æ–≤—Ç–æ—Ä–∏—Ç—å –º–∞—Ç–µ—Ä–∏–∞–ª –∏ –ø–æ–ø—Ä–æ–±–æ–≤–∞—Ç—å —Å–Ω–æ–≤–∞.
            </p>
            <button onclick="location.reload()" class="btn" style="margin-top: 20px;">
              üîÑ –ü–æ–ø—Ä–æ–±–æ–≤–∞—Ç—å —Å–Ω–æ–≤–∞
            </button>
            <button onclick="location.href='education.html'" class="btn" style="margin-top: 20px; margin-left: 10px; background: white; color: var(--primary); border: 2px solid var(--primary);">
              üìö –ü–æ–≤—Ç–æ—Ä–∏—Ç—å –º–∞—Ç–µ—Ä–∏–∞–ª
            </button>
          </div>
        `);
      }
    } else {
      throw new Error('–û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤');
    }
  } catch (error) {
    console.error('–û—à–∏–±–∫–∞:', error);
    alert('‚ùå –û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ —Ç–µ—Å—Ç–∞. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –µ—â–µ —Ä–∞–∑.');
  }
}

function showResult(html) {
  const resultDiv = document.getElementById('result');
  resultDiv.innerHTML = html;
  resultDiv.scrollIntoView({ behavior: 'smooth', block: 'center' });
}

// –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º —Ç–µ—Å—Ç –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
window.addEventListener('DOMContentLoaded', generateQuiz);
</script>

</body>
</html>
