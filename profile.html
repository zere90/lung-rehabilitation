<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<title>–õ–∏—á–Ω—ã–π –∫–∞–±–∏–Ω–µ—Ç</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<link rel="stylesheet" href="style.css">
<script src="auth-check.js"></script>
</head>

<body>

<header class="header">
  <div class="container header-inner">

    <div class="logo">
      <a href="index.html">–†–µ–∞–±–∏–ª–∏—Ç–∞—Ü–∏—è –ª—ë–≥–∫–∏—Ö</a>
    </div>

    <nav class="nav">
      <a href="index.html">–ì–ª–∞–≤–Ω–∞—è</a>
      <a href="education.html">–û–±—É—á–µ–Ω–∏–µ</a>
      <a href="materials.html">–ú–∞—Ç–µ—Ä–∏–∞–ª—ã</a>
      <a href="profile.html">–õ–∏—á–Ω—ã–π –∫–∞–±–∏–Ω–µ—Ç</a>
    </nav>

    <div class="burger" onclick="toggleMenu()">‚ò∞</div>

  </div>

  <div class="mobile-nav" id="mobileNav">
    <a href="index.html">–ì–ª–∞–≤–Ω–∞—è</a>
    <a href="education.html">–û–±—É—á–µ–Ω–∏–µ</a>
    <a href="materials.html">–ú–∞—Ç–µ—Ä–∏–∞–ª—ã</a>
    <a href="profile.html">–õ–∏—á–Ω—ã–π –∫–∞–±–∏–Ω–µ—Ç</a>
  </div>
</header>

<section class="container" style="padding:80px 0;">

<h1 class="section-title">–õ–∏—á–Ω—ã–π –∫–∞–±–∏–Ω–µ—Ç</h1>

<div class="card" style="margin-bottom:30px;">
  <h3>–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å</h3>
  <p><strong>–ò–º—è:</strong> <span id="userName">–ó–∞–≥—Ä—É–∑–∫–∞...</span></p>
  <p><strong>Email:</strong> <span id="userEmail">–ó–∞–≥—Ä—É–∑–∫–∞...</span></p>
  <p><strong>–°—Ç–∞—Ç—É—Å –∫—É—Ä—Å–∞:</strong> <span id="courseStatus">–ó–∞–≥—Ä—É–∑–∫–∞...</span></p>
</div>

<div class="card">
  <h3>–ü—Ä–æ–≥—Ä–µ—Å—Å –æ–±—É—á–µ–Ω–∏—è</h3>
  
  <div class="progress-bar" style="width: 100%; height: 30px; background: #E3F2FD; border-radius: 15px; overflow: hidden; margin: 20px 0;">
    <div id="progressFill" style="height: 100%; background: #1E88E5; width: 0%; transition: width 0.3s;"></div>
  </div>
  
  <p id="progressText" style="font-size: 18px; font-weight: bold; color: #1E88E5;">–ü—Ä–æ–π–¥–µ–Ω–æ —É—Ä–æ–∫–æ–≤: 0 –∏–∑ 7</p>
  
  <div id="certificateSection" style="margin-top: 30px; display: none;">
    <p style="color: #2e7d32; font-weight: bold;">‚úÖ –í—ã —É—Å–ø–µ—à–Ω–æ –∑–∞–≤–µ—Ä—à–∏–ª–∏ –æ–±—Ä–∞–∑–æ–≤–∞—Ç–µ–ª—å–Ω—É—é –ø—Ä–æ–≥—Ä–∞–º–º—É!</p>
    <a href="certificate.html" class="btn">üìú –ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç</a>
  </div>
  
  <div id="testSection" style="margin-top: 20px; display: none;">
    <p style="color: #f57c00;">‚ö†Ô∏è –ü—Ä–æ–π–¥–∏—Ç–µ —Ç–µ—Å—Ç –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–∞</p>
    <a href="test.html" class="btn">üìù –ü—Ä–æ–π—Ç–∏ —Ç–µ—Å—Ç</a>
  </div>
</div>

</section>

<script src="menu.js"></script>
<script>
checkAuth();

// –ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
async function loadUserProfile() {
  try {
    // –ü–æ–ª—É—á–∞–µ–º –¥–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
    const userResponse = await fetch('/api/user');
    if (!userResponse.ok) {
      window.location.href = 'auth.html';
      return;
    }
    const user = await userResponse.json();
    
    // –û—Ç–æ–±—Ä–∞–∂–∞–µ–º –¥–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è - –ü–û–ö–ê–ó–´–í–ê–ï–ú FULL_NAME!
    document.getElementById('userName').textContent = user.full_name || user.username || '–ù–µ —É–∫–∞–∑–∞–Ω–æ';
    document.getElementById('userEmail').textContent = user.email || '–ù–µ —É–∫–∞–∑–∞–Ω–æ';
    
    // –ü–æ–ª—É—á–∞–µ–º –ø—Ä–æ–≥—Ä–µ—Å—Å
    const progressResponse = await fetch('/api/progress');
    if (progressResponse.ok) {
      const progress = await progressResponse.json();
      const completed = progress.filter(p => p.completed).length;
      const total = 7;
      const percent = (completed / total) * 100;
      
      // –û–±–Ω–æ–≤–ª—è–µ–º –ø—Ä–æ–≥—Ä–µ—Å—Å-–±–∞—Ä
      document.getElementById('progressFill').style.width = percent + '%';
      document.getElementById('progressText').textContent = `–ü—Ä–æ–π–¥–µ–Ω–æ —É—Ä–æ–∫–æ–≤: ${completed} –∏–∑ ${total}`;
      
      // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å—Ç–∞—Ç—É—Å –∫—É—Ä—Å–∞
      if (completed === total) {
        // –í—Å–µ —É—Ä–æ–∫–∏ –ø—Ä–æ–π–¥–µ–Ω—ã, –ø—Ä–æ–≤–µ—Ä—è–µ–º —Ç–µ—Å—Ç
        const testResponse = await fetch('/api/test/results');
        if (testResponse.ok) {
          const testData = await testResponse.json();
          const passedTest = testData.results?.find(r => r.passed);
          
          if (passedTest) {
            document.getElementById('courseStatus').textContent = '–ó–∞–≤–µ—Ä—à—ë–Ω ‚úÖ';
            document.getElementById('certificateSection').style.display = 'block';
          } else {
            document.getElementById('courseStatus').textContent = '–¢—Ä–µ–±—É–µ—Ç—Å—è —Ç–µ—Å—Ç';
            document.getElementById('testSection').style.display = 'block';
          }
        } else {
          document.getElementById('courseStatus').textContent = '–¢—Ä–µ–±—É–µ—Ç—Å—è —Ç–µ—Å—Ç';
          document.getElementById('testSection').style.display = 'block';
        }
      } else {
        document.getElementById('courseStatus').textContent = `–í –ø—Ä–æ—Ü–µ—Å—Å–µ (${completed}/7)`;
      }
    }
    
  } catch (error) {
    console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –ø—Ä–æ—Ñ–∏–ª—è:', error);
    document.getElementById('userName').textContent = '–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏';
    document.getElementById('userEmail').textContent = '–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏';
  }
}

// –ó–∞–≥—Ä—É–∂–∞–µ–º –¥–∞–Ω–Ω—ã–µ –ø—Ä–∏ –æ—Ç–∫—Ä—ã—Ç–∏–∏ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
window.addEventListener('DOMContentLoaded', loadUserProfile);
</script>

</body>
</html>
